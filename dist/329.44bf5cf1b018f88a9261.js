(self.webpackChunktiny_host_common=self.webpackChunktiny_host_common||[]).push([[329],{329:(s,e,t)=>{"use strict";t.r(e),t.d(e,{default:()=>u});var r=function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("div",{staticClass:"content",attrs:{id:"tiny-login"}},[t("h1",[s._v("login")]),s._v(" "),t("div",{staticClass:"form"},[t("div",{staticClass:"field"},[t("input",{directives:[{name:"model",rawName:"v-model",value:s.username,expression:"username"}],ref:"username",attrs:{placeholder:"username"},domProps:{value:s.username},on:{input:function(e){e.target.composing||(s.username=e.target.value)}}})]),s._v(" "),t("div",{staticClass:"field"},[t("input",{directives:[{name:"model",rawName:"v-model",value:s.password,expression:"password"}],attrs:{placeholder:"password",type:"password",pattern:s.registering?"\\w{4,}":null},domProps:{value:s.password},on:{keyup:function(e){if(!e.type.indexOf("key")&&s._k(e.keyCode,"enter",13,e.key,"Enter"))return null;!s.registering&&s.login()},input:function(e){e.target.composing||(s.password=e.target.value)}}}),s._v(" "),s.registering?t("span",{staticClass:"error"},[s._v(s._s((s.username||s.password)&&s.password.length<4?"At least 4 characters.":""))]):s._e()]),s._v(" "),s.registering?t("div",{staticClass:"field"},[t("input",{directives:[{name:"model",rawName:"v-model",value:s.confirmpass,expression:"confirmpass"}],attrs:{placeholder:"confirm password",type:"password",pattern:s.password},domProps:{value:s.confirmpass},on:{keyup:function(e){return!e.type.indexOf("key")&&s._k(e.keyCode,"enter",13,e.key,"Enter")?null:s.register()},input:function(e){e.target.composing||(s.confirmpass=e.target.value)}}}),s._v(" "),t("span",{staticClass:"error"},[s._v(s._s(s.password&&s.password!==s.confirmpass?"this != password":""))])]):s._e()]),s._v(" "),t("div",{attrs:{id:"buttons"}},[s.registering?[t("button",{on:{click:function(e){s.registering=!1}}},[s._v("cancel")]),s._v(" "),t("button",{staticClass:"primary",attrs:{disabled:!s.valid||s.working},on:{click:function(e){return s.register()}}},[s._v("register")])]:[s.canRegister?t("a",{on:{click:function(e){s.registering=!0}}},[s._v("register")]):s._e(),s._v(" "),t("div",{staticStyle:{"flex-grow":"1"}}),s._v(" "),t("button",{staticClass:"primary",attrs:{disabled:!s.valid||s.working},on:{click:s.login}},[s._v("login")])]],2)])};r._withStripped=!0;var i=t(79),a=t(517);const n={name:"tiny-login",data:()=>({registering:!1,canRegister:!0,working:!1,username:"",password:"",confirmpass:""}),watch:{registering(s,e){!s!=!e&&(this.username="",this.password="",this.confirmpass="")}},computed:{valid(){return this.username&&this.password&&/\w{4,}/.test(this.password)&&(!this.registering||this.confirmpass===this.password)}},mounted(){var s;this.$route.query.username&&(this.username=""+this.$route.query.username),null===(s=this.$refs.username)||void 0===s||s.focus()},methods:{async register(){if(this.working||!this.valid)return;this.working=!0;await i.Z.auth.register(this.username,this.password).then((()=>!0),(()=>!1))&&(await(0,a.h7)({title:"Registered",message:'Registered as "'+this.username+'"!',type:"success",alert:!0}),this.registering=!1),this.working=!1},async login(){var s;if(this.working||!this.username||!this.password)return;this.working=!0;let e=await i.Z.auth.login(this.username,this.password).then((()=>!0),(s=>!1));e||null===(s=this.$refs.username)||void 0===s||s.focus(),e&&(e=await i.Z.getSelf().then((()=>!0),(()=>!1))),e&&(!this.$route.query.goto||this.$route.query.goto instanceof Array?this.$router.push("/"):this.$router.push(this.$route.query.goto)),this.working=!1}}};var o=(0,t(900).Z)(n,r,[],!1,null,null,null);o.options.__file="src/web/pages/login.vue";const u=o.exports}}]);