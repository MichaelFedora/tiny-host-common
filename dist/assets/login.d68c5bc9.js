var C=Object.defineProperty,q=Object.defineProperties;var V=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var K=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var k=(e,s,n)=>s in e?C(e,s,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[s]=n,c=(e,s)=>{for(var n in s||(s={}))K.call(s,n)&&k(e,n,s[n]);if(v)for(var n of v(s))j.call(s,n)&&k(e,n,s[n]);return e},h=(e,s)=>q(e,V(s));import{d as A,z as E,L as M,J as U,r as D,B as F,c as N,o as S,M as z,h as i,i as t,t as p,j as f,K as m,p as $,l as w,F as b,g as l}from"./vendor.92434493.js";import{a as J,l as y,m as L,d as T}from"./index.2406ed0f.js";const G=A({name:"tiny-login",setup(e,s){const n=E(),d=M(),r=U({registering:!1,canRegister:!0,working:!1,username:"",password:"",confirmpass:""}),g=D(null);F(()=>r.registering,(a,u)=>{!a!=!u&&(r.username="",r.password="",r.confirmpass="")});const o=N(()=>Boolean(r.username&&r.password&&/\w{4,}/.test(r.password)&&(!r.registering||r.confirmpass===r.password)));S(()=>{var a;n.query.username&&(r.username=""+n.query.username),(a=g.value)==null||a.focus()});async function R(){if(r.working||!o.value)return;r.working=!0,await y.auth.register(r.username,r.password).then(()=>!0,()=>!1)&&(await L.open({title:"Registered",message:'Registered as "'+r.username+'"!',type:"success",alert:!0}),r.registering=!1),r.working=!1}async function B(){var u;if(r.working||!r.username||!r.password)return;r.working=!0;let a=await y.auth.login(r.username,r.password).then(()=>!0,ne=>!1);a||(u=g.value)==null||u.focus(),a&&(a=await y.getSelf().then(()=>!0,()=>!1)),a?n.query.goto&&!(n.query.goto instanceof Array)?d.push(n.query.goto):d.push("/"):T.clear(),r.working=!1}return h(c({},z(r)),{valid:o,register:R,login:B})}}),H={id:"tiny-login"},I={class:"form"},O={class:"field"},P={class:"field"},Q=["pattern"],W={key:0,class:"error"},X={key:0,class:"field"},Y=["pattern"],Z={class:"error"},_={id:"buttons"},x=t("div",{style:{"flex-grow":"1"}},null,-1),ee=["disabled"],se=["disabled"];function re(e,s,n,d,r,g){return l(),i("div",H,[t("h1",null,p(e.registering?"register":"login"),1),t("div",I,[t("div",O,[f(t("input",{placeholder:"username",ref:"usernameEl","onUpdate:modelValue":s[0]||(s[0]=o=>e.username=o)},null,512),[[m,e.username]])]),t("div",P,[f(t("input",{placeholder:"password",type:"password","onUpdate:modelValue":s[1]||(s[1]=o=>e.password=o),pattern:e.registering?"\\w{4,}":null,onKeyup:s[2]||(s[2]=$(o=>e.registering?null:e.login(),["enter"]))},null,40,Q),[[m,e.password]]),e.registering?(l(),i("span",W,p((e.username||e.password)&&e.password.length<4?"At least 4 characters.":""),1)):w("",!0)]),e.registering?(l(),i("div",X,[f(t("input",{placeholder:"confirm password",type:"password","onUpdate:modelValue":s[3]||(s[3]=o=>e.confirmpass=o),pattern:e.password,onKeyup:s[4]||(s[4]=$(o=>e.register(),["enter"]))},null,40,Y),[[m,e.confirmpass]]),t("span",Z,p(e.password&&e.password!==e.confirmpass?"this != password":""),1)])):w("",!0)]),t("div",_,[e.registering?(l(),i(b,{key:1},[t("button",{onClick:s[7]||(s[7]=o=>e.registering=!1)},"cancel"),t("button",{class:"primary",onClick:s[8]||(s[8]=o=>e.register()),disabled:!e.valid||e.working},"register",8,se)],64)):(l(),i(b,{key:0},[e.canRegister?(l(),i("a",{key:0,onClick:s[5]||(s[5]=o=>e.registering=!0)},"register")):w("",!0),x,t("button",{class:"primary",disabled:!e.valid||e.working,onClick:s[6]||(s[6]=(...o)=>e.login&&e.login(...o))},"login",8,ee)],64))])])}var ie=J(G,[["render",re]]);export{ie as default};
