var se=Object.defineProperty,ne=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var K=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var V=(s,e,t)=>e in s?se(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,P=(s,e)=>{for(var t in e||(e={}))ae.call(e,t)&&V(s,t,e[t]);if(K)for(var t of K(e))re.call(e,t)&&V(s,t,e[t]);return s},A=(s,e)=>ne(s,oe(e));import{d as B,r as y,c as z,o as ie,n as le,a as ue,b as H,e as M,w as F,T as ce,f as de,g as f,h as w,i as p,j as U,v as pe,t as E,k as he,l as S,m as W,u as g,p as me,q as G,s as fe,S as J,x as Q,y as O,z as T,A as C,B as ye,C as ge,D as ve,F as j,E as $e,G as d,H as _e}from"./vendor.beb7d023.js";const we=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&o(r)}).observe(document,{childList:!0,subtree:!0});function t(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(n){if(n.ep)return;n.ep=!0;const i=t(n);fetch(n.href,i)}};we();const ke={class:"modal-card"},be={key:0,class:"field"},Ee=["type","placeholder","required","readonly"],Ce={class:"error"},Se=["disabled","onKeydown"],X=B({props:{title:String,message:String,type:{type:String,default:"primary"},alert:Boolean,prompt:{type:Object,default:()=>null},valid:{type:Boolean,default:!0}},emits:["confirm","cancel","destroy"],setup(s,{emit:e}){const t=s,o=y(!1),n=y(void 0),i=y(null),r=y(null),c=z(()=>({[t.type]:!0})),l=z(()=>t.prompt?Object.assign({type:"text",placeholder:"",required:!1,readonly:Boolean(t.alert)},t.prompt):null);ie(()=>{var _;o.value=!0,le(()=>{var k,m;return l.value?(k=i.value)==null?void 0:k.focus():(m=r.value)==null?void 0:m.focus()}),window.addEventListener("keyup",N),((_=t.prompt)==null?void 0:_.value)&&(n.value=t.prompt.value)}),ue(()=>{window.removeEventListener("keyup",N)});function v(){!o.value||(e("confirm",l.value?n.value:!0),D())}function $(){!o.value||(e("cancel"),D())}function D(){!o.value||(o.value=!1,e("destroy"))}function N(_){!o.value||(_.key==="Enter"?v():_.key==="Escape"&&$())}return(_,k)=>(f(),H(de,{to:"body"},[M(ce,{name:"fade"},{default:F(()=>[o.value?(f(),w("div",G({key:0,class:["modal is-active",g(c)],role:"dialog","aria-modal":"true"},_.$attrs),[p("div",{class:"modal-background",onClick:k[0]||(k[0]=m=>$())}),p("div",ke,[U(p("header",null,[p("span",null,E(s.title),1)],512),[[pe,s.title]]),p("section",null,[he(_.$slots,"default",{},()=>[p("p",null,E(s.message),1),g(l)?(f(),w("div",be,[U(p("input",{ref:(m,L)=>{L.inputEl=m,i.value=m},class:W({[s.type]:!0}),type:g(l).type,placeholder:g(l).placeholder,required:g(l).required,readonly:g(l).readonly,"onUpdate:modelValue":k[1]||(k[1]=m=>n.value=m)},null,10,Ee),[[fe,n.value]]),p("span",Ce,E(g(l).required&&n.value===""?"required":""),1)])):S("",!0)])]),p("footer",null,[s.alert?S("",!0):(f(),w("button",{key:0,onClick:$},"cancel")),p("button",{class:W({[s.type]:!0}),ref:(m,L)=>{L.submitEl=m,r.value=m},disabled:g(l)&&g(l).required&&!n.value||!s.valid,onClick:v,onKeydown:me($,["esc"])},E(s.alert?"ok":"confirm"),43,Se)])])],16)):S("",!0)]),_:3})]))}});var R=new class{constructor(){this._modalRequest=new J,this._dismissAllRequest=new J}get modalRequest(){return this._modalRequest.asObservable()}get dismissAllRequest(){return this._dismissAllRequest.asObservable()}async open(e){let t;const o=new Promise(n=>t=n);return this._modalRequest.next(A(P({},e),{onCancel:()=>t(void 0),onConfirm:n=>t(n)})),o}dismissAll(){this._dismissAllRequest.next()}openRoot(e){return new Promise((t,o)=>{let n;const i=()=>{var r;n&&(n.unmount(),(r=n._container)==null||r.remove(),n=null)};try{n=Q(X,A(P({},e),{onCancel:()=>t(void 0),onConfirm:c=>t(c),onClose:()=>{setTimeout(()=>i(),150)}}));const r=document.createElement("div");document.body.appendChild(r),n.mount(r)}catch(r){o(r)}})}};function Re(){return{display:"flex",flexFlow:"column",flexWrap:"nowrap",alignItems:"center",justifyContent:"center",position:"fixed",top:"0",left:"0",height:"100%",width:"100%",backgroundColor:"transparent"}}function qe(s){return O("div",{staticStyle:Re()},[O(s)])}async function Le(s,e){var o,n;const t=((n=(o=s.response)==null?void 0:o.data)==null?void 0:n.message)||s.message||String(s);return R.open({title:e?"Error "+e:"Error",message:t,type:"danger",alert:!0})}class Pe{constructor(){this.user=null,this.type=void 0}get session(){return localStorage.getItem("sid")}set session(e){localStorage.setItem("sid",e)}clear(){localStorage.clear(),this.user=null}}var a=new Pe;const Ae="modulepreload",Y={},Be="/",q=function(e,t){return!t||t.length===0?e():Promise.all(t.map(o=>{if(o=`${Be}${o}`,o in Y)return;Y[o]=!0;const n=o.endsWith(".css"),i=n?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${i}`))return;const r=document.createElement("link");if(r.rel=n?"stylesheet":Ae,n||(r.as="script",r.crossOrigin=""),r.href=o,document.head.appendChild(r),n)return new Promise((c,l)=>{r.addEventListener("load",c),r.addEventListener("error",l)})})).then(()=>e())};var I=(s,e)=>{for(const[t,o]of e)s[t]=o;return s};const Me={name:"tiny-not-found"},Oe={id:"tiny-not-found"},Te=p("h1",null,"404 Not Found",-1),je=C("Couldn't find the page you were looking for. Try going "),Ie=C("Home"),xe=C("?");function De(s,e,t,o,n,i){const r=T("router-link");return f(),w("div",Oe,[Te,p("p",null,[je,M(r,{to:"/"},{default:F(()=>[Ie]),_:1}),xe])])}var Ne=I(Me,[["render",De]]);const Ke=()=>q(()=>import("./home.5a92cfad.js"),["assets/home.5a92cfad.js","assets/home.b9259a25.css","assets/vendor.beb7d023.js"]),Ve=()=>q(()=>import("./sessions.6eaa0b03.js"),["assets/sessions.6eaa0b03.js","assets/sessions.3a67df2b.css","assets/vendor.beb7d023.js"]),ze=()=>q(()=>import("./login.552f03b8.js"),["assets/login.552f03b8.js","assets/login.4d80efd9.css","assets/vendor.beb7d023.js"]),He=()=>q(()=>import("./handshake.fbc2e1fa.js"),["assets/handshake.fbc2e1fa.js","assets/handshake.131171cd.css","assets/vendor.beb7d023.js"]),b=ye({history:ge(),routes:[{path:"/",component:Ke,name:"home"},{path:"/sessions",component:Ve,name:"sessions"},{path:"/login",component:ze,name:"login"},{path:"/handshake",component:He,name:"handshake"},{path:"/:pathMatch(.*)*",component:Ne,name:"not-found"}]});b.beforeEach((s,e,t)=>{const o="tiny "+(a.type?a.type+"s ":"")+"host";if(s.path!==e.path)if(s.name)document.title=o+" - "+s.name.toString().split("-").map(n=>n[0].toLocaleUpperCase()+n.slice(1)).join(" ");else if(s.path.length>1){const n=[];let i="";s.path.slice(1).split("/").forEach(r=>{r?i?n.push(i+r):n.push(r):i+="/"}),document.title=o+" - "+n.join(" - ")}else document.title=o;!a.session&&!/^\/login/.test(s.path)&&t(`/login?goto=${s.fullPath}`),t()});const Fe=B({components:{Modal:X},setup(){var r;const s=y(Boolean(a.session)),e=y(a.type||""),t=y(((r=a.user)==null?void 0:r.username)||""),o=y(b.currentRoute.value.name||""),n=y([]);R.modalRequest.subscribe(c=>{n.value.push(c)});const i=c=>{n.value.splice(c,1)};return R.dismissAllRequest.subscribe(()=>{const c=n.value;n.value=[];for(const l of c)l.onCancel()}),ve(b.currentRoute,(c,l)=>{var v,$;c.path!==l.path&&(/^\/login/.test(c.path)?(s.value&&(s.value=Boolean(a.session)),t.value&&(t.value=($=a.user)==null?void 0:$.username)):(s.value||(s.value=Boolean(a.session)),t.value||(t.value=(v=a.user)==null?void 0:v.username)),o.value=c.name)}),{loggedIn:s,type:e,username:t,page:o,modalList:n,destroyModal:i}}}),Ue={id:"app"};function We(s,e,t,o,n,i){const r=T("router-view"),c=T("Modal");return f(),w(j,null,[p("div",Ue,[p("h3",null,[C("tiny "+E(s.type?s.type+"s ":"")+"host",1),s.loggedIn?(f(),w(j,{key:0},[C(" - "+E(s.username),1)],64)):S("",!0)]),M(r)]),(f(!0),w(j,null,$e(s.modalList,(l,v)=>(f(),H(c,G({key:"modal-"+v},l,{onDestroy:$=>s.destroyModal(v),onConfirm:l.onConfirm,onCancel:l.onCancel}),null,16,["onDestroy","onConfirm","onCancel"]))),128))],64)}var Ge=I(Fe,[["render",We]]);const Je={name:"tiny-loading"},Qe={id:"tiny-loading"};function Xe(s,e,t,o,n,i){return f(),w("div",Qe)}var Z=I(Je,[["render",Xe]]);const u=location.origin;function h(s){var e,t,o;!s||(((e=s.response)==null?void 0:e.status)===403&&((o=(t=s.response)==null?void 0:t.data)==null?void 0:o.message)==="No session found!"&&a.clear(),!a.session&&!/^\/login/.test(b.currentRoute.value.path)&&b.push(`/login?goto=${b.currentRoute.value.fullPath}`),Le(s))}class Ye{constructor(){this._auth=Object.freeze({async login(e,t){await d.post(`${u}/auth/login`,{username:e,password:t}).then(o=>a.session=String(o.data),o=>{throw h(o),o})},async register(e,t){return d.post(`${u}/auth/register`,{username:e,password:t}).then(()=>null,o=>{throw h(o),o})},async refresh(){await d.get(`${u}/auth/refresh?sid=${a.session}`).then(e=>a.session=String(e.data),h)},async getSessions(){return d.get(`${u}/auth/sessions?sid=${a.session}`).then(e=>e.data).catch(e=>{throw h(e),e})},async delSession(e){await d.delete(`${u}/auth/sessions/${e}?sid=${a.session}`).catch(h)},async clearSessions(){await d.delete(`${u}/auth/sessions?sid=${a.session}`).catch(h)},async logout(){await d.post(`${u}/auth/logout?sid=${a.session}`).catch(h),a.clear()},async changePass(e,t){await d.post(`${u}/auth/change-pass?sid=${a.session}`,{password:e,newpass:t}).catch(o=>{throw h(o),o})},async getHandshakeInfo(e){return d.get(`${u}/auth/handshake/${e}?sid=${a.session}`).then(t=>t.data,h)},approveHandshake(e){location.href=`${u}/auth/handshake/${e}/approve?sid=${a.session}`},cancelHandshake(e){location.href=`${u}/auth/handshake/${e}/cancel?sid=${a.session}`},async getMasterKeys(){return d.get(`${u}/auth/master-key?sid=${a.session}`).then(e=>e.data,e=>{throw h(e),e})},async addMasterKey(e){return d.post(`${u}/auth/master-key?name=${e}&sid=${a.session}`).then(t=>t.data,t=>{throw h(t),t})},async updateMasterKey(e,t){await d.put(`${u}/auth/master-key/${e}?sid=${a.session}`,{name:t})},async delMasterKey(e){await d.delete(`${u}/auth/master-key/${e}?sid=${a.session}`)}})}get url(){return u}get auth(){return this._auth}async getType(){const e=await d.get(`${u}/type`).then(t=>t.data).catch(t=>{});return a.type=e,e}async getSelf(){const e=await d.get(`${u}/self?sid=${a.session}`).then(t=>t.data).catch(t=>{throw h(t),t});return a.user=e,e}async deleteSelf(e){await d.delete(`${u}/self?sid=${a.session}&pass=${e}`).catch(t=>{throw h(t),t}),a.clear()}}var ee=new Ye;console.log("Environment: ","production");const te=_e({loaded:!1}),Ze=B({setup(){return()=>te.loaded?O(Ge,{key:"app"}):qe(Z)}}),x=Q(Ze);x.use(b);x.component("tiny-loading",Z);x.mount("#app");(async()=>{await ee.getType(),a.session&&await ee.getSelf().catch(()=>{})})().then(()=>{console.log("Initialized Main!"),te.loaded=!0},s=>{console.error("Error initializing main: ",s.stack||s.message||s),R.openRoot({title:"Error",message:"Error initializing main: "+String(s.message||s),type:"danger",alert:!0})});export{X as _,I as a,a as d,ee as l,R as m,b as r};
