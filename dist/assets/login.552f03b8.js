var C=Object.defineProperty,q=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var c=Object.getOwnPropertySymbols;var V=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var k=(e,r,s)=>r in e?C(e,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[r]=s,h=(e,r)=>{for(var s in r||(r={}))V.call(r,s)&&k(e,s,r[s]);if(c)for(var s of c(r))j.call(r,s)&&k(e,s,r[s]);return e},R=(e,r)=>q(e,B(r));import{d as A,H as D,r as E,D as K,c as U,o as F,J as M,h as i,i as o,t as p,j as f,I as m,p as b,l as w,F as $,g as l}from"./vendor.beb7d023.js";import{a as N,r as t,l as v,m as S,d as H}from"./index.4969d68a.js";const I=A({name:"tiny-login",setup(e,r){const s=D({registering:!1,canRegister:!0,working:!1,username:"",password:"",confirmpass:""}),d=E(null);K(()=>s.registering,(a,u)=>{!a!=!u&&(s.username="",s.password="",s.confirmpass="")});const g=U(()=>Boolean(s.username&&s.password&&/\w{4,}/.test(s.password)&&(!s.registering||s.confirmpass===s.password)));F(()=>{var a;t.currentRoute.value.query.username&&(s.username=""+t.currentRoute.value.query.username),(a=d.value)==null||a.focus()});async function y(){if(s.working||!g.value)return;s.working=!0,await v.auth.register(s.username,s.password).then(()=>!0,()=>!1)&&(await S.open({title:"Registered",message:'Registered as "'+s.username+'"!',type:"success",alert:!0}),s.registering=!1),s.working=!1}async function n(){var u;if(s.working||!s.username||!s.password)return;s.working=!0;let a=await v.auth.login(s.username,s.password).then(()=>!0,ee=>!1);a||(u=d.value)==null||u.focus(),a&&(a=await v.getSelf().then(()=>!0,()=>!1)),a?t.currentRoute.value&&t.currentRoute.value.query.goto&&!(t.currentRoute.value.query.goto instanceof Array)?t.push(t.currentRoute.value.query.goto):t.push("/"):H.clear(),s.working=!1}return R(h({},M(s)),{valid:g,register:y,login:n})}}),J={id:"tiny-login"},T={class:"form"},z={class:"field"},G={class:"field"},L=["pattern"],O={key:0,class:"error"},P={key:0,class:"field"},Q=["pattern"],W={class:"error"},X={id:"buttons"},Y=o("div",{style:{"flex-grow":"1"}},null,-1),Z=["disabled"],_=["disabled"];function x(e,r,s,d,g,y){return l(),i("div",J,[o("h1",null,p(e.registering?"register":"login"),1),o("div",T,[o("div",z,[f(o("input",{placeholder:"username",ref:"usernameEl","onUpdate:modelValue":r[0]||(r[0]=n=>e.username=n)},null,512),[[m,e.username]])]),o("div",G,[f(o("input",{placeholder:"password",type:"password","onUpdate:modelValue":r[1]||(r[1]=n=>e.password=n),pattern:e.registering?"\\w{4,}":null,onKeyup:r[2]||(r[2]=b(n=>e.registering?null:e.login(),["enter"]))},null,40,L),[[m,e.password]]),e.registering?(l(),i("span",O,p((e.username||e.password)&&e.password.length<4?"At least 4 characters.":""),1)):w("",!0)]),e.registering?(l(),i("div",P,[f(o("input",{placeholder:"confirm password",type:"password","onUpdate:modelValue":r[3]||(r[3]=n=>e.confirmpass=n),pattern:e.password,onKeyup:r[4]||(r[4]=b(n=>e.register(),["enter"]))},null,40,Q),[[m,e.confirmpass]]),o("span",W,p(e.password&&e.password!==e.confirmpass?"data != password":""),1)])):w("",!0)]),o("div",X,[e.registering?(l(),i($,{key:1},[o("button",{onClick:r[7]||(r[7]=n=>e.registering=!1)},"cancel"),o("button",{class:"primary",onClick:r[8]||(r[8]=n=>e.register()),disabled:!e.valid||e.working},"register",8,_)],64)):(l(),i($,{key:0},[e.canRegister?(l(),i("a",{key:0,onClick:r[5]||(r[5]=n=>e.registering=!0)},"register")):w("",!0),Y,o("button",{class:"primary",disabled:!e.valid||e.working,onClick:r[6]||(r[6]=(...n)=>e.login&&e.login(...n))},"login",8,Z)],64))])])}var oe=N(I,[["render",x]]);export{oe as default};
